(this["webpackJsonpaks-deploy-guide2"]=this["webpackJsonpaks-deploy-guide2"]||[]).push([[0],{110:function(e,t,n){},112:function(e,t,n){"use strict";n.r(t),n.d(t,"appInsights",(function(){return ce})),n.d(t,"ConfigContext",(function(){return le}));var r=n(0),s=n.n(r),a=n(49),i=n.n(a),o=(n(110),n(20)),c=n(5),l=n(30),d=n(189),u=n(198),p=n(200),b=n(183),g=n(56),h=n(193),m=n(188),y=n(176),j=n(79),f=n(3),x=n(191),v=n(9),k=n(186),O=n(195),w=n(196),S=n(197),A=n(13),I=n(205),C=n(181),P=n(2),z=Object(f.C)({fontSize:80,margin:"0 80px"}),N=function(e){var t=e.sections,n=e.updateCardValues,s=Object(r.useState)({}),a=Object(l.a)(s,2),i=a[0],p=a[1];return Object(r.useEffect)((function(){p(t.reduce((function(e,t){return Object(c.a)(Object(c.a)({},e),{},Object(o.a)({},t.key,t.cards.find((function(e){return e.default})).key))}),{}));var e,r=Object(j.a)(t);try{for(r.s();!(e=r.n()).done;){var s=e.value,a=s.cards.find((function(e){return e.default}));a&&n(s.key,a.key)}}catch(i){r.e(i)}finally{r.f()}}),[t]),console.log("presets render: selected=(".concat(JSON.stringify(i),")")),[].concat.apply([],t.map((function(e){return[Object(P.jsx)(h.a,{styles:{root:{marginTop:"15px !important",marginBottom:"15px"}},children:Object(P.jsx)("b",{children:e.sectionTitle})},"sep".concat(e.key)),Object(P.jsx)(P.Fragment,{children:e.sectionWarning&&Object(P.jsx)(x.a,{styles:{root:{marginBottom:"15px",fontSize:"15px"}},messageBarType:v.a.severeWarning,children:e.sectionWarning})}),Object(P.jsx)(d.a,{horizontal:!0,tokens:{childrenGap:15},children:e.cards.map((function(t,r){return Object(P.jsxs)(k.a,{onClick:function(){return r=e.key,s=t.key,p(Object(c.a)(Object(c.a)({},i),{},Object(o.a)({},r,s))),void n(r,s);var r,s},tokens:{childrenMargin:12},children:[Object(P.jsx)(O.a,{styles:{root:{padding:"8px 16px",position:"relative"}},children:Object(P.jsx)(w.a,{checked:i[e.key]===t.key,label:t.title,styles:{label:{fontWeight:i[e.key]===t.key?"500":"normal"}}})}),t.imageSrc&&Object(P.jsx)(S.a,{styles:{root:{backgroundColor:"white"}},imageSrc:t.imageSrc,height:150,imageFit:A.b.centerContain}),t.icon&&Object(P.jsx)(I.a,{styles:{root:{backgroundColor:"white",borderBottom:"0"}},previewImages:[{previewIconProps:{iconName:t.icon,className:z},height:100}]}),Object(P.jsx)("div",{style:{padding:"8px 16px"},children:Object(P.jsxs)(u.a,{children:[t.description.title,t.description.titleWarning&&Object(P.jsx)(x.a,{messageBarType:t.description.titleWarning.MessageBarType,children:Object(P.jsx)(u.a,{children:t.description.titleWarning.description})}),Object(P.jsx)(u.a,{variant:"smallPlus",children:Object(P.jsx)("ul",{style:{paddingInlineStart:"20px"},children:t.description.bulets.map((function(e,t){return Object(P.jsxs)("li",{children:[e.description,e.linksrc&&Object(P.jsxs)("span",{children:[" (",Object(P.jsx)("a",{target:"_nsg",href:e.linksrc,children:"docs"}),")"]})]},t)}))})})]})}),t.author&&Object(P.jsx)(C.a,{activity:t.author.status,people:[{name:t.author.name,initials:t.author.initials}]})]},t.key)}))},"stack".concat(e.key))]})))},E=n(33),G=n(184),_=n(180),D=n(185),T=n(15),K=n(192),M=n(57),B=n(187),W=n(72);function V(e,t){return e.findIndex((function(e){return e.field===t}))>=0}function R(e,t){var n=e.findIndex((function(e){return e.field===t}));return n>=0?e[n].message:""}var F={root:{border:"1px solid",background:"#fcfcfc",margin:"10px 0",padding:"15px"}},L={tokens:{childrenGap:15},styles:{root:{width:300}}},q=function(e){var t=e.tabValues,n=e.updateFn,a=e.invalidArray,i=(e.featureFlag,t.net),o=t.addons,c=Object(r.useState)(!1),p=Object(l.a)(c,2),b=p[0],g=p[1],m=s.a.createRef();return Object(P.jsxs)(d.a,{tokens:{childrenGap:15},styles:F,children:[Object(P.jsxs)(d.a.Item,{children:[Object(P.jsx)(E.a,{required:!0,children:"Network Plugin"}),Object(P.jsx)(x.a,{children:'Typically, only use "kubenet" networking if you need to limit your non-routable IP usage on your network (use network calculator)'}),Object(P.jsx)(G.a,{styles:{root:{marginLeft:"50px"}},selectedKey:i.networkPlugin,options:[{key:"kubenet",text:'Use "kubenet" basic networking, so your PODs DO NOT receive VNET IPs'},{key:"azure",text:'Use "CNI" for fastest container networking, but using more IPs'}],onChange:function(e,t){var r=t.key;return n("networkPlugin",r)}})]}),Object(P.jsx)(h.a,{className:"notopmargin"}),Object(P.jsxs)(d.a.Item,{children:[Object(P.jsx)(E.a,{children:"Deploy Azure firewall for your cluster egress (Custom VNet Only)"}),V(a,"afw")&&Object(P.jsx)(x.a,{messageBarType:v.a.error,children:R(a,"afw")}),Object(P.jsx)(w.a,{styles:{root:{marginLeft:"50px",marginTop:"10 !important"}},disabled:!1,errorMessage:R(a,"afw"),checked:i.afw,onChange:function(e,t){return n("afw",t)},label:"Implement Azure Firewall & UDR nexthop"})]}),Object(P.jsx)(h.a,{className:"notopmargin"}),Object(P.jsxs)(d.a.Item,{children:[Object(P.jsx)(E.a,{children:"Secure Azure service resources to your virtual network by extending VNet identity to the service"}),Object(P.jsx)(w.a,{styles:{root:{marginLeft:"50px"}},disabled:!1,checked:i.serviceEndpointsEnable,onChange:function(e,t){return n("serviceEndpointsEnable",t)},label:"Enable Service Endpoints"}),i.serviceEndpointsEnable&&Object(P.jsxs)(d.a,{styles:{root:{marginLeft:"50px",marginTop:"10px"}},tokens:{childrenGap:10},children:[Object(P.jsx)(x.a,{messageBarType:v.a.info,children:"No Network Address Translation (NAT) or gateway devices required to access your Azure dependencies from your pods"}),Object(P.jsx)(_.a,{required:!0,placeholder:"Select options",label:"Select the Azure Dependencies you would like to secure to your AKS VNET",selectedKeys:i.serviceEndpoints,onChange:function(e,t){var r=t.key,s=t.selected;n("serviceEndpoints",s?function(e,t){return e.includes(t)?e:e.concat(t)}(i.serviceEndpoints,r):function(e,t){var n=e.indexOf(t);return n>=0?[].concat(Object(W.a)(e.slice(0,n)),Object(W.a)(e.slice(n+1))):e}(i.serviceEndpoints,r))},multiSelect:!0,options:[{key:"Microsoft.AzureActiveDirectory",text:"Microsoft.AzureActiveDirectory"},{key:"Microsoft.AzureCosmosDB",text:"Microsoft.AzureCosmosDB"},{key:"Microsoft.CognitiveServices",text:"Microsoft.CognitiveServices"},{key:"Microsoft.ContainerRegistry",text:"Microsoft.ContainerRegistry"},{key:"Microsoft.EventHub",text:"Microsoft.EventHub"},{key:"Microsoft.KeyVault",text:"Microsoft.KeyVault"},{key:"Microsoft.ServiceBus",text:"Microsoft.ServiceBus"},{key:"Microsoft.Sql",text:"Microsoft.Sql"},{key:"Microsoft.Storage",text:"Microsoft.Storage"},{key:"Microsoft.Web",text:"Microsoft.Web"}]})]})]}),Object(P.jsx)(h.a,{className:"notopmargin"}),Object(P.jsxs)(d.a.Item,{children:[Object(P.jsx)(E.a,{children:"Uses a private IP address from your VNet to access your dependent Azure service, such as Azure Storage, Azure Cosmos DB, SQL"}),Object(P.jsx)(w.a,{styles:{root:{marginLeft:"50px",marginTop:"0 !important"}},disabled:!1,checked:i.vnetprivateend,onChange:function(e,t){return n("vnetprivateend",t)},label:"Enable Private Link"})]}),Object(P.jsx)(h.a,{className:"notopmargin"}),Object(P.jsx)(d.a.Item,{children:Object(P.jsxs)(d.a,{horizontal:!0,children:[Object(P.jsxs)(d.a.Item,{children:[Object(P.jsx)(E.a,{children:"Default or Custom VNET"}),Object(P.jsxs)("div",{ref:m,style:{marginTop:0},children:[Object(P.jsx)(G.a,{styles:{root:{marginLeft:"50px"}},selectedKey:i.vnet_opt,onClick:function(){return g(!0)},onChange:function(e,t){var r=t.key;return n("vnet_opt",r)},options:[{key:"default",iconProps:{iconName:"CubeShape"},text:"Default Networking"},{key:"custom",iconProps:{iconName:"CityNext"},text:"Custom Networking"},{key:"byo",disabled:!1,iconProps:{iconName:"WebAppBuilderFragment"},text:"BYO VNET (TBC)"}]}),V(a,"vnet_opt")&&Object(P.jsx)(x.a,{messageBarType:v.a.error,children:R(a,"vnet_opt")})]})]}),Object(P.jsxs)(d.a.Item,{children:[b&&"default"===i.vnet_opt&&Object(P.jsxs)(D.a,{className:"ms-CalloutExample-callout",target:m,directionalHint:T.a.leftCenter,isBeakVisible:!0,gapSpace:10,setInitialFocus:!0,onDismiss:function(){return g(!1)},children:[Object(P.jsx)(x.a,{messageBarType:v.a.info,children:"Default - Fully Managed Networking"}),Object(P.jsxs)("div",{style:{padding:"10px",maxWidth:"450px"},children:[Object(P.jsxs)(u.a,{children:["Select this option if you ",Object(P.jsx)(u.a,{style:{fontWeight:"bold"},children:" don't"})," require any custom IP settings, so you are not peering with other VNETs or On-Premises networks This is the simplest AKS deployment to operate, it provides a ",Object(P.jsx)(u.a,{style:{fontWeight:"bold"},children:" managed"})," network setup, including:"]}),Object(P.jsxs)("ul",{children:[Object(P.jsx)("li",{children:"New Dedicated VNET with private IP range for your agents nodes"}),Object(P.jsx)("li",{children:"Container Networking (default: CNI)"}),Object(P.jsx)("li",{children:"Standard LoadBalancer for kubernetes services with outbound rule for internet access"})]})]})]}),b&&"custom"===i.vnet_opt&&Object(P.jsxs)(D.a,{className:"ms-CalloutExample-callout",target:m,directionalHint:T.a.leftCenter,isBeakVisible:!0,gapSpace:10,setInitialFocus:!0,onDismiss:function(){return g(!1)},children:[Object(P.jsx)(x.a,{messageBarType:v.a.warning,children:"Custom Networking - Advanced Setup"}),Object(P.jsx)("div",{style:{padding:"10px",maxWidth:"500px"},children:Object(P.jsxs)(u.a,{children:["Select this option if you will you would like the helper to create a new VNET with specific ranges, use this option if you need to:",Object(P.jsxs)("ul",{children:[Object(P.jsx)("li",{children:"Connect your AKS network with another networks"}),Object(P.jsx)("li",{children:"You will be VNET peering or using an ExpressRoute or VPN Gateway"})]})]})})]}),b&&"byo"===i.vnet_opt&&Object(P.jsxs)(D.a,{className:"ms-CalloutExample-callout",target:m,directionalHint:T.a.leftCenter,isBeakVisible:!0,gapSpace:10,setInitialFocus:!0,onDismiss:function(){return g(!1)},children:[Object(P.jsx)(x.a,{messageBarType:v.a.warning,children:"Bring your own Networking - Advanced Setup"}),Object(P.jsxs)("div",{style:{padding:"10px",maxWidth:"500px"},children:[Object(P.jsx)(u.a,{children:"Select this option if you will be deploying AKS into an existing network configuration, for example."}),Object(P.jsxs)("ul",{children:[Object(P.jsxs)("li",{children:["If you are implementing the Secure Baseline Architecture ",Object(P.jsx)(K.a,{target:"_",href:"https://docs.microsoft.com/azure/architecture/reference-architectures/containers/aks/secure-baseline-aks",children:"here"}),Object(P.jsx)(M.a,{imageFit:A.b.CenterContain,width:"100%",src:"./secure-baseline-architecture.svg"})]}),Object(P.jsx)("li",{children:"If you will deploy AKS into a pre-existing VNET, managed by a networking team"})]})]})]})]})]})}),"custom"===i.vnet_opt?Object(P.jsx)(H,{addons:o,net:i,updateFn:n}):"byo"===i.vnet_opt&&Object(P.jsx)(Z,{addons:o,net:i,updateFn:n,invalidArray:a})]})};function U(e){var t=e.net,n=e.updateFn;return Object(P.jsxs)(d.a,Object(c.a)(Object(c.a)({},L),{},{children:[Object(P.jsx)(E.a,{children:"Kubernetes Networking Configuration"}),Object(P.jsx)(d.a.Item,{align:"start",children:Object(P.jsx)(B.a,{prefix:"Cidr",label:"POD Network",disabled:"kubenet"!==t.networkPlugin,onChange:function(e,t){return n("podCidr",t)},value:"kubenet"===t.networkPlugin?t.podCidr:"IPs from subnet"})}),Object(P.jsxs)(d.a.Item,{align:"start",children:[Object(P.jsx)(B.a,{prefix:"Cidr",label:"Service Network",onChange:function(e,t){return n("serviceCidr",t)},value:t.serviceCidr}),Object(P.jsxs)(x.a,{messageBarType:v.a.warning,children:["Address space that isn't in use elsewhere in your network environment ",Object(P.jsx)("a",{target:"_target",href:"https://docs.microsoft.com/en-us/azure/aks/configure-kubenet#create-an-aks-cluster-in-the-virtual-network",children:"docs"})]})]}),Object(P.jsxs)(d.a.Item,{align:"start",children:[Object(P.jsx)(B.a,{prefix:"IP",label:"Service Network",onChange:function(e,t){return n("dnsServiceIP",t)},value:t.dnsServiceIP}),Object(P.jsxs)(x.a,{messageBarType:v.a.warning,children:["Ensure its an address within the Service CIDR above ",Object(P.jsx)("a",{target:"_target",href:"https://docs.microsoft.com/en-us/azure/aks/configure-kubenet#create-an-aks-cluster-in-the-virtual-network",children:"docs"})]})]})]}))}function Z(e){var t=e.net,n=e.addons,r=e.updateFn,s=e.invalidArray;return Object(P.jsxs)(d.a,{styles:F,children:[Object(P.jsx)(E.a,{children:"Kubernetes Network Configuration"}),Object(P.jsxs)(d.a,{horizontal:!0,tokens:{childrenGap:50},styles:{root:{width:650}},children:[Object(P.jsx)(d.a,Object(c.a)({},L)),Object(P.jsx)(U,{net:t,updateFn:r})]}),Object(P.jsx)(E.a,{children:"Bring your Own VNET and Subnets"}),Object(P.jsxs)(x.a,{children:["Get your user subnet by running ",Object(P.jsxs)(E.a,{children:["az network vnet subnet show --vnet-name `","<net name>","` -g `","<vnet rg>","` -n `","<subnet name>",'` --query "id"']})]}),Object(P.jsx)(B.a,{value:t.byoAKSSubnetId,onChange:function(e,t){return r("byoAKSSubnetId",t)},errorMessage:R(s,"byoAKSSubnetId"),required:!0,placeholder:"Resource Id",label:Object(P.jsx)(u.a,{style:{fontWeight:600},children:"Enter your existing AKS Nodes subnet ResourceId"})}),Object(P.jsx)(h.a,{className:"notopmargin"}),Object(P.jsx)(B.a,{disabled:"appgw"!==n.ingress,value:t.byoAGWSubnetId,onChange:function(e,t){return r("byoAGWSubnetId",t)},errorMessage:R(s,"byoAGWSubnetId"),required:!0,placeholder:"Resource Id",label:Object(P.jsx)(u.a,{style:{fontWeight:600},children:"Enter your existing Application Gateway subnet ResourceId"})}),Object(P.jsxs)(x.a,{messageBarType:v.a.warning,children:["Ensure your Application Gateway subnet meets these requirements ",Object(P.jsx)(K.a,{href:"https://docs.microsoft.com/en-us/azure/application-gateway/configuration-infrastructure#size-of-the-subnet",children:"here"})]})]})}function H(e){var t=e.net,n=e.addons,r=e.updateFn;return Object(P.jsxs)(d.a,{styles:F,children:[Object(P.jsx)(E.a,{children:"Custom Network VNET & Kubernetes Network Configuration"}),Object(P.jsxs)(d.a,{horizontal:!0,tokens:{childrenGap:50},styles:{root:{width:650}},children:[Object(P.jsxs)(d.a,Object(c.a)(Object(c.a)({},L),{},{children:[Object(P.jsx)(d.a.Item,{align:"start",children:Object(P.jsx)(B.a,{prefix:"Cidr",label:"VNET Address space",onChange:function(e,t){return r("vnetAddressPrefix",t)},value:t.vnetAddressPrefix})}),Object(P.jsx)(d.a.Item,{align:"center",children:Object(P.jsx)(B.a,{prefix:"Cidr",label:"AKS Nodes subnet",onChange:function(e,t){return r("vnetAksSubnetAddressPrefix",t)},value:t.vnetAksSubnetAddressPrefix})}),Object(P.jsx)(d.a.Item,{align:"center",children:Object(P.jsx)(B.a,{prefix:"Cidr",disabled:!t.afw,label:"Azure Firewall subnet",onChange:function(e,t){return r("vnetFirewallSubnetAddressPrefix",t)},value:t.afw?t.vnetFirewallSubnetAddressPrefix:"No Firewall requested"})}),Object(P.jsxs)(d.a.Item,{align:"center",children:[Object(P.jsx)(B.a,{prefix:"Cidr",disabled:"appgw"!==n.ingress,label:"Application Gateway subnet",onChange:function(e,t){return r("vnetAppGatewaySubnetAddressPrefix",t)},value:"appgw"===n.ingress?t.vnetAppGatewaySubnetAddressPrefix:"N/A"}),Object(P.jsxs)(x.a,{messageBarType:v.a.warning,children:["Ensure your Application Gateway subnet meets these requirements ",Object(P.jsx)(K.a,{href:"https://docs.microsoft.com/en-us/azure/application-gateway/configuration-infrastructure#size-of-the-subnet",children:"here"})]})]})]})),Object(P.jsx)(U,{net:t,updateFn:r})]})]})}var Y=n(190),$=function(e){var t=e.tabValues,n=e.updateFn,r=e.invalidArray,s=t.addons,a=t.net,i=t.deploy;return Object(P.jsxs)(d.a,{tokens:{childrenGap:15},styles:F,children:[Object(P.jsxs)(d.a.Item,{align:"start",children:[Object(P.jsx)(E.a,{children:"Cluster Monitoring requirements"}),Object(P.jsx)(x.a,{children:"Observing your clusters health is critical to smooth operations, select the managed Azure Monitor for Containers option, or the opensource CNCF Prometheus/Grafana solution"}),Object(P.jsx)(G.a,{styles:{root:{marginLeft:"50px"}},selectedKey:s.monitor,options:[{key:"none",text:"None"},{key:"aci",text:"Azure Monitor for Containers (logs and metrics)"},{key:"oss",text:"Prometheus / Grafana Helm Chart (metrics only)"}],onChange:function(e,t){var r=t.key;return n("monitor",r)}})]}),Object(P.jsx)(d.a.Item,{align:"center",styles:{root:{width:"600px",display:"aci"!==s.monitor?"none":"block"}},children:Object(P.jsx)(_.a,{label:"Log and Metrics Data Retention (Days)",onChange:function(e,t){var r=t.key;return n("retentionInDays",r)},selectedKey:s.retentionInDays,options:[{key:30,text:"30 Days"},{key:60,text:"60 Days"},{key:90,text:"90 Days"},{key:120,text:"120 Days"},{key:180,text:"180 Days"},{key:270,text:"270 Days"},{key:365,text:"365 Days"}]})}),Object(P.jsx)(h.a,{className:"notopmargin"}),Object(P.jsxs)(d.a.Item,{align:"start",children:[Object(P.jsx)(E.a,{children:"Azure Policy, to manage and report on the compliance state of your Kubernetes clusters"}),Object(P.jsx)(x.a,{children:"Azure Policy extends Gatekeeper v3, an admission controller webhook for Open Policy Agent (OPA), to apply at-scale enforcements and safeguards on your clusters in a centralized, consistent manner."}),Object(P.jsx)(G.a,{styles:{root:{marginLeft:"50px"}},selectedKey:s.azurepolicy,options:[{key:"none",text:"No restrictions, users can deploy any kubernetes workloads"},{key:"audit",text:"AUDIT compliance with the set of cluster pod security baseline standards for Linux-based workloads"},{key:"deny",text:"BLOCK and non-compliant Linux-based workloads with the set of cluster pod security baseline standards"}],onChange:function(e,t){var r=t.key;return n("azurepolicy",r)}}),"none"!==s.azurepolicy&&Object(P.jsxs)(x.a,{messageBarType:"audit"===s.azurepolicy?v.a.success:v.a.blocked,styles:{root:{marginLeft:"50px",width:"700px"}},children:["The template will automatically assign and ",Object(P.jsx)("b",{children:s.azurepolicy})," the following ",Object(P.jsx)(K.a,{target:"_target",href:"https://github.com/Azure/azure-policy/blob/master/built-in-policies/policySetDefinitions/Kubernetes/Kubernetes_PSPBaselineStandard.json",children:"Policies"}),":",Object(P.jsxs)("ul",{children:[Object(P.jsx)("li",{children:"Do not allow privileged containers in Kubernetes cluster"}),Object(P.jsx)("li",{children:"Kubernetes cluster pods should only use approved host network and port range"}),Object(P.jsx)("li",{children:"Kubernetes cluster containers should not share host process ID or host IPC namespace"}),Object(P.jsx)("li",{children:"Kubernetes cluster containers should only use allowed capabilities"}),Object(P.jsx)("li",{children:"Kubernetes cluster pod hostPath volumes should only use allowed host paths"})]})]})]}),Object(P.jsx)(h.a,{className:"notopmargin"}),Object(P.jsxs)(d.a.Item,{align:"start",children:[Object(P.jsx)(E.a,{children:"Cluster East-West traffic restrictions (Network Policies)"}),Object(P.jsx)(x.a,{children:"Control which components can communicate with each other. The principle of least privilege should be applied to how traffic can flow between pods in an Azure Kubernetes Service (AKS) cluster"}),Object(P.jsx)(G.a,{styles:{root:{marginLeft:"50px"}},selectedKey:s.networkPolicy,options:[{key:"none",text:"No restrictions, all PODs can access each other"},{key:"calico",text:'Use Network Policy addon with Calico to implemented intra-cluster traffic restrictions (driven from "NetworkPolicy" objects)'},{key:"azure",text:'Use Network Policy addon with Azure provider to implemented intra-cluster traffic restrictions (driven from "NetworkPolicy" objects)'}],onChange:function(e,t){var r=t.key;return n("networkPolicy",r)}})]}),Object(P.jsx)(h.a,{className:"notopmargin"}),Object(P.jsxs)(d.a.Item,{align:"start",children:[Object(P.jsx)(E.a,{required:!0,children:"Securely Expose your applications via Layer 7 HTTP(S) proxies (Ingress Controller)"}),Object(P.jsx)(G.a,{styles:{root:{marginLeft:"50px"}},selectedKey:s.ingress,options:[{key:"none",text:"No, I do not need a Layer7 proxy, or I will configure my own solution"},{key:"appgw",text:"Yes, I want a Azure Managed Application Gateway with WAF protection"},{key:"contour",text:"Yes, deploy contour in the cluster to expose my apps to the internet (https://projectcontour.io/)"},{key:"nginx",text:"Yes, deploy nginx in the cluster to expose my apps to the internet (nginx ingress controller)"}],onChange:function(e,t){var r=t.key;return n("ingress",r)}})]}),Object(P.jsx)(d.a.Item,{align:"center",styles:{root:{maxWidth:"700px",display:"none"===s.ingress?"none":"block"}},children:Object(P.jsxs)(d.a,{tokens:{childrenGap:15},children:["nginx"===s.ingress&&!1,"none"!==s.ingress&&!1,"nginx"===s.ingress&&Object(P.jsx)(w.a,{checked:s.ingressEveryNode,onChange:function(e,t){return n("ingressEveryNode",t)},label:Object(P.jsx)(u.a,{children:"Run nginx on every node (deploy as Daemonset)"})}),"appgw"===s.ingress&&("default"===a.vnet_opt?Object(P.jsx)(x.a,{messageBarType:v.a.warning,children:"Using default networking, so addon will provision default Application Gateway instance, for more options, select custom networking in the network tab"}):Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(x.a,{messageBarType:v.a.warning,children:"Custom or BYO networking is requested, so template will provision a new Application Gateway"}),Object(P.jsx)(w.a,{checked:s.appgwKVIntegration,onChange:function(e,t){return n("appgwKVIntegration",t)},label:Object(P.jsxs)(u.a,{children:["Enable KeyVault Integration for TLS Certificates (",Object(P.jsx)(K.a,{target:"_ar1",href:"https://docs.microsoft.com/en-us/azure/application-gateway/key-vault-certs",children:"docs"}),") "]})}),V(r,"appgwKVIntegration")&&Object(P.jsx)(x.a,{styles:{root:{marginTop:"0px !important"}},messageBarType:v.a.error,children:R(r,"appgwKVIntegration")}),Object(P.jsxs)(d.a.Item,{children:[Object(P.jsx)(E.a,{style:{marginBottom:"0px"},children:"Application Gateway Type"}),Object(P.jsx)(G.a,{selectedKey:s.appGWsku,options:[{key:"Standard_v2",text:"Standard Application Gateway"},{key:"WAF_v2",text:"Web Application Firewall (WAF) on Application Gateway"}],onChange:function(e,t){var r=t.key;return n("appGWsku",r)}})]}),Object(P.jsx)(E.a,{style:{marginBottom:"0px"},children:"Capacity"}),Object(P.jsxs)(d.a,{horizontal:!0,tokens:{childrenGap:150},styles:{root:{marginTop:"0px !important"}},children:[Object(P.jsx)(d.a.Item,{children:Object(P.jsx)(G.a,{selectedKey:s.appGWautoscale,onChange:function(e,t){var r=t.key;return n("appGWautoscale",r)},options:[{key:!1,text:"Manual"},{key:!0,text:"Autoscale"}]})}),Object(P.jsx)(d.a.Item,{children:Object(P.jsxs)(d.a,{tokens:{childrenGap:0},styles:{root:{width:450}},children:[Object(P.jsx)(Y.a,{label:"".concat(s.appGWautoscale?"Minimum instance count":"Instance count"),min:s.appGWautoscale?0:1,max:125,step:1,defaultValue:s.appGWcount,showValue:!0,onChange:function(e){return n("appGWcount",e)}}),s.appGWautoscale&&Object(P.jsx)(Y.a,{label:"Maximum instance count",min:2,max:125,step:1,defaultValue:s.appGWmaxCount,showValue:!0,onChange:function(e){return n("appGWmaxCount",e)},snapToStep:!0})]})})]}),Object(P.jsx)(w.a,{checked:s.appgw_privateIp,onChange:function(e,t){return n("appgw_privateIp",t)},label:Object(P.jsxs)(u.a,{children:["Use a Private Frontend IP for Ingress (",Object(P.jsx)(K.a,{target:"_ar1",href:"https://docs.microsoft.com/en-us/azure/application-gateway/ingress-controller-private-ip",children:"docs"}),")"]})}),s.appgw_privateIp&&Object(P.jsx)(B.a,{value:s.appgw_privateIpAddress,onChange:function(e,t){return n("appgw_privateIpAddress",t)},errorMessage:R(r,"appgw_privateIpAddress"),required:!0,placeholder:"Resource Id",label:Object(P.jsxs)(u.a,{style:{fontWeight:600},children:["Enter Private IP address from the AppGW CIDR subnet range (",Object(P.jsx)("b",{children:"custom"===a.vnet_opt?a.vnetAppGatewaySubnetAddressPrefix:"examine BYO subnet range"}),")"]})})]})),("contour"===s.ingress||"nginx"===s.ingress||"appgw"===s.ingress)&&Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(w.a,{checked:s.dns,onChange:function(e,t){return n("dns",t)},label:Object(P.jsxs)(u.a,{children:["Create FQDN URLs for your applications using",Object(P.jsxs)(K.a,{target:"_t1",href:"https://github.com/kubernetes-sigs/external-dns",children:[" ",Object(P.jsx)("b",{children:"external-dns"})," "]}),"(requires Azure ",Object(P.jsxs)(K.a,{href:"https://docs.microsoft.com/en-us/azure/dns/dns-getstarted-portal#create-a-dns-zone",target:"_t1",children:[" ",Object(P.jsx)("b",{children:"Public"})," "]})," or ",Object(P.jsxs)(K.a,{href:"https://docs.microsoft.com/en-us/azure/dns/private-dns-getstarted-portal",target:"_t1",children:[" ",Object(P.jsx)("b",{children:"Private"})," "]})," DNS Zone)"]})}),s.dns&&Object(P.jsxs)(P.Fragment,{children:[Object(P.jsxs)(x.a,{messageBarType:v.a.warning,children:["If using a Public DNS Zone, you need to own a custom domain, you can easily purchase a custom domain through Azure ",Object(P.jsxs)(K.a,{target:"_t1",href:"https://docs.microsoft.com/en-us/azure/app-service/manage-custom-dns-buy-domain",children:[" ",Object(P.jsx)("b",{children:"details here"})]})]}),Object(P.jsx)(B.a,{value:s.dnsZoneId,onChange:function(e,t){return n("dnsZoneId",t)},errorMessage:R(r,"dnsZoneId"),required:!0,placeholder:"Resource Id",label:Object(P.jsxs)(u.a,{style:{fontWeight:600},children:["Enter your Public or Private Azure DNS Zone ResourceId ",Object(P.jsx)(K.a,{target:"_t2",href:"https://ms.portal.azure.com/#blade/HubsExtension/BrowseResource/resourceType/Microsoft.Network%2FdnsZones",children:"find it here"})]})}),Object(P.jsx)(w.a,{disabled:V(r,"dnsZoneId"),checked:s.certMan,onChange:function(e,t){return n("certMan",t)},label:"Automatically Issue Certificates for HTTPS using cert-manager (with Lets Encrypt - requires email"}),s.certMan&&Object(P.jsx)(B.a,{value:s.certEmail,onChange:function(e,t){return n("certEmail",t)},errorMessage:R(r,"certEmail")?"Enter valid email":"",label:"Enter mail address for certificate notification:",required:!0})]})]})]})}),Object(P.jsx)(h.a,{className:"notopmargin"}),Object(P.jsxs)(d.a.Item,{align:"start",children:[Object(P.jsx)(E.a,{required:!0,children:"Do you require a secure private container registry to store my application images"}),Object(P.jsx)(G.a,{styles:{root:{marginLeft:"50px"}},selectedKey:s.registry,options:[{key:"none",text:"No, my application images will be on DockerHub or another registry"},{key:"Basic",text:'Yes, setup Azure Container Registry "Basic" tier & authorise aks to pull images'},{key:"Standard",text:'Yes, setup Azure Container Registry "Standard" tier (recommended for production)'},{key:"Premium",text:'Yes, setup Azure Container Registry "Premium" tier (required for Service Endpoints & Private Link)'}],onChange:function(e,t){var r=t.key;return n("registry",r)}}),V(r,"registry")&&Object(P.jsx)(x.a,{styles:{root:{marginLeft:"50px",width:"700px"}},messageBarType:v.a.error,children:R(r,"registry")}),a.serviceEndpointsEnable&&a.serviceEndpoints.includes("Microsoft.ContainerRegistry")&&"Premium"===s.registry&&Object(P.jsxs)(x.a,{styles:{root:{marginLeft:"50px",width:"700px"}},messageBarType:v.a.warning,children:["As you have selected Container Registry in Networking Service Endpoint, the templte will only Allow traffic to your Registry from the AKS Subnet, and your specified IP addresses ",Object(P.jsx)("b",{children:i.apiips.split(",")})," (",Object(P.jsx)(K.a,{target:"_t2",href:"https://docs.microsoft.com/en-us/azure/container-registry/container-registry-vnet",children:"docs"}),") *** Preview feature"]})]}),Object(P.jsx)(h.a,{className:"notopmargin"}),Object(P.jsxs)(d.a.Item,{align:"start",children:[Object(P.jsxs)(E.a,{required:!0,children:["CSI Secrets : Store Kubernetes Secrets in Azure Keyvault, using AKS Managed Identity (**Preview) (",Object(P.jsx)("a",{target:"_new",href:"https://docs.microsoft.com/en-us/azure/aks/csi-secrets-store-driver",children:"docs"}),")"]}),Object(P.jsx)(G.a,{styles:{root:{marginLeft:"50px"}},selectedKey:s.csisecret,options:[{key:"none",text:"No, I am happy to use the default Kubernetes secret storage, or I will configure my own solution"},{key:"akvExist",text:"Yes, store secrets in an existing KeyVault & enable Secrets Store CSI Driver"},{key:"akvNew",text:"Yes, provision a new Azure KeyVault & enable Secrets Store CSI Driver"}],onChange:function(e,t){var r=t.key;return n("csisecret",r)}})]}),Object(P.jsxs)(d.a.Item,{align:"center",styles:{root:{minWidth:"700px",display:"none"===s.csisecret?"none":"block"}},children:[Object(P.jsxs)(x.a,{messageBarType:v.a.warning,children:["Ensure you register for this preview feature ",Object(P.jsx)(K.a,{target:"_t2",href:"https://docs.microsoft.com/en-us/azure/aks/csi-secrets-store-driver#register-the-aks-azurekeyvaultsecretsprovider-preview-feature",children:"here"})]}),Object(P.jsx)(d.a,{tokens:{childrenGap:15},children:"akvExist"===s.csisecret&&Object(P.jsx)(B.a,{value:s.kvId,onChange:function(e,t){return n("kvId",t)},errorMessage:R(r,"kvId"),required:!0,placeholder:"Resource Id",label:Object(P.jsx)(u.a,{style:{fontWeight:600},children:"Enter your Azure Key Vault Resource Id"})})})]})]})},J=n(175),Q=Object(f.C)({display:"flex",alignItems:"baseline"}),X=[{key:"b",text:"Burstable (dev/test)",itemType:J.a.Header},{key:"Standard_B2s",text:"2 vCPU,  4 GiB RAM,   8GiB SSD, 40%\t-> 200% CPU",eph:!0},{key:"dv2",text:"General purpose V2",itemType:J.a.Header},{key:"default",text:"2 vCPU,  7 GiB RAM,  14GiB SSD,  86 GiB cache (8000 IOPS)",eph:!1},{key:"Standard_DS3_v2",text:"4 vCPU, 14 GiB RAM,  28GiB SSD, 172 GiB cache (16000 IOPS)",eph:!0},{key:"dv4",text:"General purpose V4",itemType:J.a.Header},{key:"Standard_D2ds_v4",text:"2 vCPU,  8 GiB RAM,  75GiB SSD,               (19000 IOPS)",eph:!1},{key:"Standard_D4ds_v4",text:"4 vCPU, 16 GiB RAM, 150GiB SSD, 100 GiB cache (38500 IOPS)",eph:!1},{key:"Standard_D8ds_v4",text:"8 vCPU, 32 GiB RAM, 300GiB SSD,               (77000 IOPS)",eph:!0},{key:"fv2",text:"Compute optimized",itemType:J.a.Header},{key:"Standard_F2s_v2",text:"2 vCPU,  4 GiB RAM,  16GiB SSD,               (3200 IOPS)",eph:!1}],ee=function(e){var t=e.tabValues,n=e.updateFn,r=e.invalidArray,s=t.cluster;return Object(P.jsxs)(d.a,{tokens:{childrenGap:15},styles:F,children:[Object(P.jsx)(E.a,{style:{marginBottom:"10px"},children:"Cluster Performance & Scale Requirements"}),Object(P.jsxs)(d.a,{vertical:!0,tokens:{childrenGap:15},style:{marginTop:0,marginLeft:"50px"},children:[Object(P.jsx)(d.a,{horizontal:!0,tokens:{childrenGap:55},children:Object(P.jsxs)(d.a.Item,{children:[Object(P.jsxs)(E.a,{children:["System Pool Type ",Object(P.jsx)(K.a,{target:"_",href:"https://docs.microsoft.com/en-us/azure/aks/use-system-pools#system-and-user-node-pools",children:"docs"})]}),Object(P.jsx)(G.a,{selectedKey:s.SystemPoolType,options:[{key:"none",text:"No seperate system pool: Use a single pool for System and User workloads"},{key:"Cost-Optimised",text:"Cost-Optimised: use low-cost Burstable VMs, with 1-3 node autoscale"},{key:"Standard",text:"Standard: use standard 4-core VMs, with 2-3 node autoscale"}],onChange:function(e,t){var r=t.key;return n("SystemPoolType",r)}})]})}),Object(P.jsxs)(d.a,{horizontal:!0,tokens:{childrenGap:150},children:[Object(P.jsxs)(d.a.Item,{children:[Object(P.jsx)(E.a,{children:"Scale Type"}),Object(P.jsx)(G.a,{selectedKey:s.autoscale,onChange:function(e,t){var r=t.key;return n("autoscale",r)},options:[{key:!1,iconProps:{iconName:"FollowUser"},text:"Manual scale"},{key:!0,iconProps:{iconName:"ScaleVolume"},text:"Autoscale"}]})]}),Object(P.jsxs)(d.a.Item,{children:[Object(P.jsx)(E.a,{children:"Scale Values"}),Object(P.jsxs)(d.a,{tokens:{childrenGap:0},styles:{root:{width:450}},children:[Object(P.jsx)(Y.a,{label:"Initial ".concat(s.autoscale?"(& Autoscaler Min nodes)":"nodes"),min:1,max:10,step:1,defaultValue:s.count,showValue:!0,onChange:function(e){return n("count",e)}}),s.autoscale&&Object(P.jsx)(Y.a,{label:"Autoscaler Max nodes",min:5,max:100,step:5,defaultValue:s.maxCount,showValue:!0,onChange:function(e){return n("maxCount",e)},snapToStep:!0})]})]})]}),Object(P.jsxs)(d.a,{horizontal:!0,tokens:{childrenGap:55},children:[Object(P.jsxs)(d.a.Item,{children:[Object(P.jsx)(E.a,{children:"Compute Type"}),Object(P.jsx)(G.a,{selectedKey:"gp",options:[{key:"gp",iconProps:{iconName:"Processing"},text:"General Purpose"},{key:"iops",iconProps:{iconName:"OfflineStorageSolid"},text:"IO Optimised",disabled:!0},{key:"gpu",iconProps:{iconName:"Game"},text:"GPU Workloads",disabled:!0}]})]}),Object(P.jsxs)(d.a.Item,{children:[Object(P.jsx)(E.a,{children:"Node Size"}),Object(P.jsxs)(d.a,{tokens:{childrenGap:10},styles:{root:{width:450}},children:[Object(P.jsx)(_.a,{selectedKey:s.vmSize,onChange:function(e,t){var r=t.key;return n("vmSize",r)},placeholder:"Select VM Size",options:X,styles:{dropdown:{width:"100%"}}}),V(r,"osDiskType")&&Object(P.jsx)(x.a,{messageBarType:v.a.error,children:R(r,"osDiskType")}),Object(P.jsx)(G.a,{onChange:function(e,t){var r=t.key;return n("osDiskType",r)},selectedKey:s.osDiskType,options:[{key:"Ephemeral",text:"Ephemeral (Requires Node with >137GiB of cache)"},{key:"Managed",text:"Persistent in Storage Account"}]}),"Managed"===s.osDiskType&&Object(P.jsx)(_.a,{label:"OS disk size",selectedKey:s.osDiskSizeGB,onChange:function(e,t){var r=t.key;return n("osDiskSizeGB",r)},placeholder:"Select OS Disk",options:[{key:"df",text:"Use the default for the VM size",itemType:J.a.Header},{key:0,text:"default"},{key:"pd",text:"Premium SSD Managed Disks",itemType:J.a.Header},{key:32,text:"32 GiB (120 IOPS)"},{key:64,text:"64 GiB (240 IOPS)"},{key:128,text:"128 GiB (500 IOPS)"}],styles:{dropdown:{width:"100%"}}})]})]})]})]}),Object(P.jsx)(h.a,{className:"notopmargin"}),Object(P.jsxs)(d.a.Item,{align:"start",children:[Object(P.jsxs)(E.a,{required:!0,children:["Zone Support - AKS clusters deployed with multiple availability zones configured across a cluster provide a higher level of availability to protect against a hardware failure or a planned maintenance event. See ",Object(P.jsx)(K.a,{target:"_",href:"https://docs.microsoft.com/en-us/azure/aks/availability-zones#limitations-and-region-availability",children:"limits"})," before selecting"]}),Object(P.jsx)(G.a,{selectedKey:s.availabilityZones,styles:{root:{marginLeft:"50px"}},options:[{key:"no",text:"Deploy into single zone"},{key:"yes",text:"Deploy my control plane and nodes across zones 1,2,3"}],onChange:function(e,t){var r=t.key;return n("availabilityZones",r)}})]}),Object(P.jsx)(h.a,{className:"notopmargin"}),Object(P.jsxs)(d.a.Item,{align:"start",children:[Object(P.jsx)(E.a,{required:!0,children:"Cluster Auto-upgrade"}),Object(P.jsx)(G.a,{selectedKey:s.upgradeChannel,styles:{root:{marginLeft:"50px"}},options:[{key:"none",text:"Disables auto-upgrades"},{key:"patch",text:"Patch: auto-upgrade cluster to the latest supported patch version when it becomes available while keeping the minor version the same."},{key:"stable",text:"Stable: auto-upgrade cluster to the latest supported patch release on minor version N-1, where N is the latest supported minor version"},{key:"rapid",text:"Rapid: auto-upgrade cluster to the latest supported patch release on the latest supported minor version."}],onChange:function(e,t){var r=t.key;return n("upgradeChannel",r)}})]}),Object(P.jsx)(h.a,{className:"notopmargin"}),Object(P.jsxs)(d.a,{horizontal:!0,tokens:{childrenGap:142},styles:{root:{marginTop:10}},children:[Object(P.jsx)(d.a.Item,{children:Object(P.jsx)(G.a,{styles:{root:{marginLeft:"50px"}},label:Object(P.jsxs)(E.a,{children:["Cluster User Authentication ",Object(P.jsx)(K.a,{target:"_",href:"https://docs.microsoft.com/en-gb/azure/aks/managed-aad",children:"docs"})]}),selectedKey:s.enable_aad,onChange:function(e,t){var r=t.key;return n("enable_aad",r)},options:[{key:!1,iconProps:{iconName:"UserWarning"},text:"Kubernetes"},{key:!0,iconProps:{iconName:"AADLogo"},text:"AAD Integrated"}]})}),Object(P.jsx)(d.a.Item,{children:s.enable_aad&&Object(P.jsxs)(d.a,{tokens:{childrenGap:10},styles:{root:{width:450,marginTop:"30px"}},children:[Object(P.jsx)(G.a,{styles:{root:{width:300}},selectedKey:s.use_alt_aad,options:[{key:!1,text:"Use the AKS subscription tenant"},{key:!0,text:"Use alt. tenant",onRenderField:function(e,t){return Object(P.jsxs)("div",{className:Q,children:[t(e),Object(P.jsx)(B.a,{value:s.aad_tenant_id,onChange:function(e,t){return n("aad_tenant_id",t)},errorMessage:R(r,"aad_tenant_id"),styles:{root:{marginLeft:5}},disabled:!!e&&!s.use_alt_aad,required:!0,placeholder:"tenant id"})]})}}],onChange:function(e,t){var r=t.key;return n("use_alt_aad",r)}}),Object(P.jsx)(w.a,{checked:s.enableAzureRBAC,onChange:function(e,t){return n("enableAzureRBAC",t)},onRenderLabel:function(){return Object(P.jsxs)(u.a,{styles:{root:{color:"black"}},children:["Azure RBAC for Kubernetes Authorization ",Object(P.jsx)(K.a,{target:"_",href:"https://docs.microsoft.com/en-us/azure/aks/manage-azure-rbac",children:"docs"}),"**"]})}}),s.enableAzureRBAC?Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(E.a,{children:"Assign Cluster Admin Role to user (optional)"}),Object(P.jsxs)(x.a,{styles:{root:{marginBottom:"10px"}},children:["Get your user principleId by running ",Object(P.jsxs)(E.a,{children:["az ad user show --id `","<work-email>","` --query objectId --out tsv"]})]}),Object(P.jsx)(B.a,{prefix:"AAD PrincipleId",onChange:function(e,t){return n("adminprincipleid",t)},value:s.adminprincipleid})]}):Object(P.jsxs)(P.Fragment,{children:[Object(P.jsx)(B.a,{label:"AAD Group objectIDs that will have admin role of the cluster ',' separated",onChange:function(e,t){return n("aadgroupids",t)},value:s.aadgroupids}),s.enable_aad&&!s.aadgroupids&&Object(P.jsxs)(x.a,{messageBarType:v.a.warning,children:["You will be forbidden to do any kubernetes options unless you add a AAD Groups here, or follow ",Object(P.jsx)(K.a,{target:"_",href:"https://docs.microsoft.com/en-us/azure/aks/azure-ad-rbac#create-the-aks-cluster-resources-for-app-devs",children:"this"})," after the cluster is created"]})]})]})})]}),Object(P.jsx)(h.a,{className:"notopmargin"}),Object(P.jsxs)(d.a.Item,{align:"start",children:[Object(P.jsx)(E.a,{required:!0,children:"Cluster API Server Security"}),Object(P.jsx)(G.a,{selectedKey:s.apisecurity,styles:{root:{marginLeft:"50px"}},options:[{key:"none",text:"Public IP with no IP restrictions"},{key:"whitelist",text:"Create allowed IP ranges (defaults to IP address of machine running the script)"},{key:"private",text:"Private Cluster (WARNING: most complex to operate)"}],onChange:function(e,t){var r=t.key;return n("apisecurity",r)}})]}),Object(P.jsxs)(d.a.Item,{align:"center",styles:{root:{maxWidth:"700px",display:"private"===s.apisecurity?"block":"none"}},children:[Object(P.jsx)(E.a,{style:{marginBottom:"0px"},children:"Private dns zone mode for private cluster."}),Object(P.jsx)(d.a,{tokens:{childrenGap:15},children:"private"===s.apisecurity&&Object(P.jsx)(G.a,{selectedKey:s.privateDNSZone,onChange:function(e,t){var r=t.key;return n("privateDNSZone",r)},options:[{key:"none",text:"None: Defaults to public DNS (AKS will not create a Private DNS Zone)"},{key:"system",disabled:!0,text:"System: AKS will create a Private DNS Zone in the Node Resource Group"},{key:"custom",disabled:!0,text:"Custom: BYO Private DNS Zone (provide ResourceId)"}]})})]})]})},te=function(e){var t,n=e.defaults,r=e.updateFn,s=e.tabValues,a=e.invalidArray,i=e.invalidTabs,l=s.net,b=s.addons,g=s.cluster,j=s.deploy,f=!(i&&i.length>0),k=j.apiips.split(",").filter((function(e){return e.trim()})),O=Object(c.a)(Object(c.a)({},l.vnetAddressPrefix!==n.net.vnetAddressPrefix&&{vnetAddressPrefix:l.vnetAddressPrefix}),l.vnetAksSubnetAddressPrefix!==n.net.vnetAksSubnetAddressPrefix&&{vnetAksSubnetAddressPrefix:l.vnetAksSubnetAddressPrefix}),w=Object(c.a)(Object(c.a)({},l.serviceCidr!==n.net.serviceCidr&&{serviceCidr:l.serviceCidr}),l.dnsServiceIP!==n.net.dnsServiceIP&&{dnsServiceIP:l.dnsServiceIP}),S=Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)({resourceName:j.clusterName,kubernetesVersion:j.kubernetesVersion,agentCount:g.count},"none"===g.SystemPoolType?{JustUseSystemPool:!0}:g.SystemPoolType!==n.cluster.SystemPoolType&&{SystemPoolType:g.SystemPoolType}),"default"!==g.vmSize&&{agentVMSize:g.vmSize}),g.autoscale&&{agentCountMax:g.maxCount}),"Managed"===g.osDiskType&&Object(c.a)({osDiskType:g.osDiskType},g.osDiskSizeGB>0&&{osDiskSizeGB:g.osDiskSizeGB})),"custom"===l.vnet_opt&&Object(c.a)(Object(c.a)({custom_vnet:!0},w),O)),"byo"===l.vnet_opt&&Object(c.a)({byoAKSSubnetId:l.byoAKSSubnetId},w)),"byo"===l.vnet_opt&&"appgw"===b.ingress&&{byoAGWSubnetId:l.byoAGWSubnetId}),g.enable_aad&&Object(c.a)({enable_aad:!0},!1===g.enableAzureRBAC&&g.aad_tenant_id&&{aad_tenant_id:g.aad_tenant_id})),g.enable_aad&&g.enableAzureRBAC&&Object(c.a)({enableAzureRBAC:!0},g.adminprincipleid&&{adminprincipleid:g.adminprincipleid})),"none"!==b.registry&&{registries_sku:b.registry}),l.afw&&Object(c.a)({azureFirewalls:!0},"custom"===l.vnet_opt&&n.net.vnetFirewallSubnetAddressPrefix!==l.vnetFirewallSubnetAddressPrefix&&{vnetFirewallSubnetAddressPrefix:l.vnetFirewallSubnetAddressPrefix})),l.serviceEndpointsEnable&&l.serviceEndpoints.length>0&&{serviceEndpoints:l.serviceEndpoints.map((function(e){return{service:e}}))}),"aci"===b.monitor&&{omsagent:!0,retentionInDays:b.retentionInDays}),"none"!==b.networkPolicy&&{networkPolicy:b.networkPolicy}),"none"!==b.azurepolicy&&{azurepolicy:b.azurepolicy}),{},{networkPlugin:l.networkPlugin},"custom"===l.vnet_opt&&"kubenet"===l.networkPlugin&&n.net.podCidr!==l.podCidr&&{podCidr:l.podCidr}),"yes"===g.availabilityZones&&{availabilityZones:["1","2","3"]}),"whitelist"===g.apisecurity&&k.length>0&&{authorizedIPRanges:k}),"private"===g.apisecurity&&{enablePrivateCluster:!0}),b.dns&&b.dnsZoneId&&{dnsZoneId:b.dnsZoneId}),"appgw"===b.ingress&&Object(c.a)(Object(c.a)({ingressApplicationGateway:!0},"custom"===l.vnet_opt&&n.net.vnetAppGatewaySubnetAddressPrefix!==l.vnetAppGatewaySubnetAddressPrefix&&{vnetAppGatewaySubnetAddressPrefix:l.vnetAppGatewaySubnetAddressPrefix}),"default"!==l.vnet_opt&&Object(c.a)(Object(c.a)(Object(c.a)({appGWcount:b.appGWcount,appGWsku:b.appGWsku},b.appGWautoscale&&{appGWmaxCount:b.appGWmaxCount}),b.appgw_privateIp&&{privateIpApplicationGateway:b.appgw_privateIpAddress}),b.appgwKVIntegration&&"akvNew"===b.csisecret&&{appgwKVIntegration:!0}))),l.serviceEndpointsEnable&&l.serviceEndpoints.includes("Microsoft.KeyVault")&&"akvNew"===b.csisecret&&{AKVserviceEndpointFW:k.length>0?k[0]:"vnetonly"}),"akvNew"===b.csisecret&&{createKV:!0}),A=Object(c.a)(Object(c.a)(Object(c.a)(Object(c.a)({},l.serviceEndpointsEnable&&l.serviceEndpoints.includes("Microsoft.ContainerRegistry")&&"Premium"===b.registry&&{ACRserviceEndpointFW:k.length>0?k[0]:"vnetonly"}),"none"!==b.gitops&&{gitops:b.gitops}),"none"!==b.csisecret&&{azureKeyvaultSecretsProvider:!0}),"none"!==g.upgradeChannel&&{upgradeChannel:g.upgradeChannel}),I=Object(c.a)(Object(c.a)({},S),!j.disablePreviews&&A),C="aks-".concat(j.clusterName),z="agw-".concat(j.clusterName),N="# Create Resource Group \n"+"az group create -l ".concat(j.location," -n ").concat(j.rg," \n\n")+"# Deploy template with in-line parameters \n"+"az deployment group create -g ".concat(j.rg,"  ").concat("--template-uri https://github.com/Azure/Aks-Construction/releases/download/0.1.5-preview/main.json"," --parameters")+(t=I,Object.keys(t).map((function(e){var n=t[e],r=Array.isArray(n)?JSON.stringify(n).replaceAll(" ","").replaceAll('"','\\"'):n;return" \\\n\t".concat(e,"=").concat(r)})).join("")),G=JSON.stringify(function(e){return Object.keys(e).reduce((function(t,n){return Object(c.a)(Object(c.a)({},t),{},{parameters:Object(c.a)(Object(c.a)({},t.parameters),{},Object(o.a)({},n,{value:e[n]}))})}),{$schema:"https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",contentVersion:"1.0.0.0",parameters:{}})}(I),null,2).replaceAll("\\\\\\","").replaceAll("\\\\\\",""),D="monitoring",T="monitoring",W="ingress-basic",V=("byo"===l.vnet_opt&&"appgw"===b.ingress?'#------- START Workaround to enable AGIC with BYO VNET (until supported by template)\nAPPGW_RG_ID="$(az group show -n '.concat(j.rg,' --query id -o tsv)"\nAPPGW_ID="$(az network application-gateway show -g ').concat(j.rg," -n ").concat(z,' --query id -o tsv)"\naz aks enable-addons -n ').concat(C," -g ").concat(j.rg,' -a ingress-appgw --appgw-id $APPGW_ID\nAKS_AGIC_IDENTITY_ID="$(az aks show -g ').concat(j.rg," -n ").concat(C,' --query addonProfiles.ingressApplicationGateway.identity.clientId -o tsv)"\naz role assignment create --role "Contributor" --assignee-principal-type ServicePrincipal --assignee-object-id $AKS_AGIC_IDENTITY_ID --scope $APPGW_ID\naz role assignment create --role "Reader" --assignee-principal-type ServicePrincipal --assignee-object-id $AKS_AGIC_IDENTITY_ID --scope $APPGW_RG_ID\n'):"")+("byo"===l.vnet_opt&&"appgw"===b.ingress?'\nAPPGW_IDENTITY="$(az network application-gateway show -g '.concat(j.rg," -n ").concat(z,' --query \'keys(identity.userAssignedIdentities)[0]\' -o tsv)"\naz role assignment create --role "Managed Identity Operator" --assignee-principal-type ServicePrincipal --assignee-object-id $AKS_AGIC_IDENTITY_ID --scope $APPGW_IDENTITY\n'):"")+("byo"===l.vnet_opt&&"appgw"===b.ingress?"#------- END Workaround\n  ":"")+"\n# Get credentials for your new AKS cluster\naz aks get-credentials -g ".concat(j.rg," -n ").concat(C," ")+("oss"===b.monitor?"\n\n# Install kube-prometheus-stack\nhelm repo add prometheus-community https://prometheus-community.github.io/helm-charts\nhelm repo update\nkubectl create namespace ".concat(D,"\nhelm install ").concat(T," prometheus-community/kube-prometheus-stack --namespace ").concat(D):"")+("nginx"===b.ingress?"\n\n# Create a namespace for your ingress resources\nkubectl create namespace ".concat(W,"\n\n# Add the ingress-nginx repository\nhelm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx\n\n# Use Helm to deploy an NGINX ingress controller\nhelm install ").concat("nginx-ingress"," ingress-nginx/ingress-nginx \\\n  --set controller.publishService.enabled=true \\\n")+(b.ingressEveryNode?"  --set controller.kind=DaemonSet \\\n  --set controller.service.externalTrafficPolicy=Local \\\n":"")+("oss"===b.monitor?"  --set controller.metrics.enabled=true \\\n  --set controller.metrics.serviceMonitor.enabled=true \\\n  --set controller.metrics.serviceMonitor.namespace=".concat(D," \\\n  --set controller.metrics.serviceMonitor.additionalLabels.release=").concat(T," \\\n"):"")+"  --namespace ".concat(W):"")+("contour"===b.ingress?"\n\n# Install Contour Ingress Controller\nkubectl apply -f https://projectcontour.io/quickstart/contour.yaml\n":"")+(b.dnsZoneId?'\n\n# Install external-dns\nkubectl create secret generic azure-config-file --from-file=azure.json=/dev/stdin<<EOF\n{\n  "userAssignedIdentityID": "$(az aks show -g '.concat(j.rg," -n ").concat(C,' --query identityProfile.kubeletidentity.clientId -o tsv)",\n  "tenantId": "$(az account show --query tenantId -o tsv)",\n  "useManagedIdentityExtension": true,\n  "subscriptionId": "').concat(b.dnsZoneId.split("/")[2],'",\n  "resourceGroup": "').concat(b.dnsZoneId.split("/")[4],'"\n}\nEOF\n\ncurl https://raw.githubusercontent.com/Azure/Aks-Construction/main/helper/config/external-dns.yml | sed -e "s|{{domain-filter}}|').concat(b.dnsZoneId.split("/")[8],'|g" -e "s|{{provider}}|').concat("privateDnsZones"===b.dnsZoneId.split("/")[7]?"azure-private-dns":"azure",'|g"  | kubectl apply -f -'):"")+(b.certEmail?'\n\n# Install cert-manager\nkubectl apply -f https://github.com/jetstack/cert-manager/releases/download/v1.5.3/cert-manager.yaml\n\nsleep 30s\n\ncat <<EOF | kubectl create -f -\napiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n  name: letsencrypt-prod\nspec:\n  acme:\n    # The ACME server URL\n    server: https://acme-v02.api.letsencrypt.org/directory\n    # Email address used for ACME registration\n    email: "'.concat(b.certEmail,'"\n    # Name of a secret used to store the ACME account private key\n    privateKeySecretRef:\n      name: letsencrypt-prod\n    # Enable the HTTP-01 challenge provider\n    solvers:\n    #- dns01:\n        # Add azureDNS resolver for Private endpoints, but this need to be fixed: https://github.com/cert-manager/website/issues/662\n        #azureDNS:\n        #  clientID: $(az aks show -g ').concat(j.rg," -n ").concat(C," --query identityProfile.kubeletidentity.clientId -o tsv)\n        #  subscriptionID: ").concat(b.dnsZoneId.split("/")[2],"\n        #  resourceGroupName: ").concat(b.dnsZoneId.split("/")[4],"\n        #  hostedZoneName: ").concat(b.dnsZoneId.split("/")[8],"\n    - http01:\n        ingress:\n          class: ").concat("contour"===b.ingress?"contour":"nginx"===b.ingress?"nginx":"azure/application-gateway","\nEOF\n"):"");return Object(P.jsxs)(d.a,{tokens:{childrenGap:15},styles:F,children:[!f&&Object(P.jsx)(x.a,{messageBarType:v.a.severeWarning,children:Object(P.jsxs)(u.a,{children:["Configuration not complete, please correct the tabs with the warning symbol ",Object(P.jsxs)("b",{children:["(",i.join(" & "),")"]})," before deploying"]})}),Object(P.jsxs)(d.a,{horizontal:!0,styles:{root:{width:"100%"}},tokens:{childrenGap:150},children:[Object(P.jsxs)(d.a,{styles:{root:{width:"300px"}},children:[Object(P.jsx)(B.a,{label:"Resource Group",onChange:function(e,t){return r("rg",t)},required:!0,errorMessage:R(a,"rg"),value:j.rg}),Object(P.jsx)(B.a,{label:"Cluster Name",onChange:function(e,t){return r("clusterName",t)},required:!0,errorMessage:R(a,"clusterName"),value:j.clusterName}),Object(P.jsx)(_.a,{label:"Location",selectedKey:j.location,onChange:function(e,t){var n=t.key;return r("location",n)},options:[{key:"europe",text:"Europe",itemType:J.a.Header},{key:"WestEurope",text:"West Europe"},{key:"NorthEurope",text:"North Europe"},{key:"UKSouth",text:"UK South"},{key:"UKSouth2",text:"UK South2"},{key:"UKWest",text:"UK West"},{key:"america",text:"North America",itemType:J.a.Header},{key:"CentralUS",text:"Central US"},{key:"EastUS",text:"East US"},{key:"EastUS2",text:"East US2"},{key:"WestUS",text:"West US"},{key:"WestUS2",text:"West US2"},{key:"WestCentralUS",text:"West Central US"}],styles:{dropdown:{width:300}}})]}),Object(P.jsxs)(d.a,{tokens:{childrenGap:20},styles:{root:{width:"450px"}},children:[Object(P.jsx)(B.a,{label:"Kubernetes version",readOnly:!1,disabled:!1,required:!0,value:j.kubernetesVersion,onChange:function(e,t){return r("kubernetesVersion",t)}}),Object(P.jsx)(d.a.Item,{styles:{root:{display:"whitelist"!==g.apisecurity?"none":"block"}},children:Object(P.jsx)(B.a,{label:"Initial api server whitelisted IPs/CIDRs  (',' seperated)",errorMessage:R(a,"apiips"),onChange:function(e,t){return r("apiips",t)},value:j.apiips,required:"whitelist"===g.apisecurity})})]})]}),Object(P.jsxs)(h.a,{styles:{root:{marginTop:"30px !important"}},children:[Object(P.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[Object(P.jsx)("b",{style:{marginRight:"10px"},children:"Deploy Cluster"}),Object(P.jsx)(M.a,{src:"./bicep.png"})," ",Object(P.jsx)("p",{style:{marginLeft:"10px"},children:"powered by Bicep"})]})," "]}),Object.keys(A).length>0&&Object(P.jsxs)(x.a,{messageBarType:v.a.warning,children:[Object(P.jsxs)(u.a,{children:["Your deployment contains Preview features: ",Object(P.jsx)("b",{children:Object.keys(A).join(", ")}),", Ensure you have registered for these previews, and have installed the ",Object(P.jsx)("b",{children:"'az extension add --name aks-preview'"}),"  before running the script, ",Object(P.jsx)(K.a,{target:"_pv",href:"https://github.com/Azure/AKS/blob/master/previews.md",children:"see here"}),", or disable preview features here"]}),Object(P.jsx)(p.a,{styles:{root:{marginTop:"10px"}},onText:"preview enabled",offText:"preview disabled",checked:!j.disablePreviews,onChange:function(e,t){return r("disablePreviews",!t)}})]}),Object(P.jsxs)(m.a,{children:[Object(P.jsxs)(y.a,{headerText:"Provision Environment (CLI)",children:[Object(P.jsx)(B.a,{value:N,rows:N.split(/\r\n|\r|\n/).length+1,readOnly:!0,label:"Commands to deploy your fully operational environment",styles:{root:{fontFamily:'Monaco, Menlo, Consolas, "Droid Sans Mono", Inconsolata, "Courier New", monospace'},field:{backgroundColor:"lightgrey",lineHeight:"21px"}},multiline:!0,errorMessage:f?"":"Please complete all items that need attention before running script"}),Object(P.jsxs)(u.a,{styles:{root:{marginTop:"2px !important"}},variant:"medium",children:["Open a Linux shell (requires 'az cli' pre-installed), or, open the",Object(P.jsx)(K.a,{target:"_cs",href:"http://shell.azure.com/",children:"Azure Cloud Shell"}),".",Object(P.jsx)(u.a,{variant:"medium",style:{fontWeight:"bold"},children:"Paste the commands"})," into the shell"]})]}),Object(P.jsx)(y.a,{headerText:"Post Configuration",children:"none"===b.gitops?Object(P.jsxs)(d.a,{children:[Object(P.jsx)(E.a,{children:"Run these commands to install the requested kubernetes packages into your cluster"}),Object(P.jsx)(x.a,{children:"Once available, we will switch to using the gitops addon here, to assure that your clusters get their source of truth from the defined git repo"}),Object(P.jsx)(B.a,{readOnly:!0,label:"Commands (requires helm)",styles:{root:{fontFamily:"SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace!important"},field:{backgroundColor:"lightgrey",lineHeight:"21px"}},multiline:!0,rows:V.split(/\r\n|\r|\n/).length+1,value:V})]}):Object(P.jsx)(d.a,{children:Object(P.jsx)(B.a,{readOnly:!0,label:"While Gitops is in preview, run this manually",styles:{root:{fontFamily:"SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace!important"},field:{backgroundColor:"lightgrey",lineHeight:"21px"}},multiline:!0,rows:6,value:"az k8sconfiguration create\n        --name cluster-config \n        --cluster-name ".concat(C,"    \n        --resource-group ").concat(j.rg,"     \n        --operator-instance-name flux     \n        --operator-namespace cluster-config     \n        --enable-helm-operator     \n        --operator-params='--git-readonly --git-path=cluster-config'     \n        --repository-url git://github.com/khowling/aks-deploy-arm.git     \n        --scope cluster     \n        --helm-operator-params='--set helm.versions=v3'     \n        --cluster-type managedclusters")})})}),Object(P.jsx)(y.a,{headerText:"Template Parameters File (for CI/CD)",children:Object(P.jsx)(B.a,{value:G,rows:G.split(/\r\n|\r|\n/).length+1,readOnly:!0,label:"Parameter file",styles:{root:{fontFamily:"SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace!important"},field:{backgroundColor:"lightgrey",lineHeight:"21px"}},multiline:!0})})]})]})},ne=n(179);function re(e){var t=e.entScale,n=e.setEntScale;e.featureFlag;return Object(P.jsxs)(d.a,{horizontal:!0,tokens:{childrenGap:10},children:[Object(P.jsx)("img",{src:"aks.svg",alt:"Kubernetes Service",style:{width:"6%",height:"auto"}}),Object(P.jsxs)(d.a,{tokens:{padding:10},children:[Object(P.jsx)(u.a,{variant:"xLarge",children:"AKS Deploy helper"}),Object(P.jsx)(u.a,{children:"Provide the requirements of your AKS deployment to generate the assets to create a full operational environment, incorporating best-practices guidance"})]}),Object(P.jsx)(d.a.Item,{tokens:{padding:10},children:Object(P.jsx)(p.a,{label:Object(P.jsxs)(u.a,{nowrap:!0,children:["Enterprise Scale"," ",Object(P.jsx)(b.a,{content:"use if you are following Enterprise Scale",children:Object(P.jsx)(g.a,{iconName:"Info","aria-label":"Info tooltip"})})]}),onText:"Yes",offText:"No",checked:t,disabled:!1,onChange:function(e,t){return n(t)}})})]})}function se(e){var t=e.config,n=Object(r.useState)(!1),s=Object(l.a)(n,2),a=s[0],i=s[1],u=Object(r.useState)("0"),p=Object(l.a)(u,2),b=p[0],j=p[1],f=t.tabLabels,x=t.defaults,v=t.entScaleOps,k=t.defaultOps;!function(e,t){Object(r.useEffect)((function(){var n=new Date,r="".concat(e,".").concat(t);return ce.startTrackPage(r),function(){console.log("exit screen ".concat(t," ").concat((new Date-n)/1e3)),ce.stopTrackPage(r,{"Component Name":e,Navigation:t},{mounttime:(new Date-n)/1e3})}}),[e,t])}("PortalNav",f[b]);var O=Object(r.useState)(Object.keys(x).reduce((function(e,t){return Object(c.a)(Object(c.a)({},e),{},Object(o.a)({},t,[]))}),{})),w=Object(l.a)(O,2),S=w[0],A=w[1],I=Object(r.useState)(!1),C=Object(l.a)(I,2),z=C[0],E=C[1],G=Object(r.useState)(x),_=Object(l.a)(G,2),D=_[0],T=_[1];function K(e,t,n){T((function(r){return Object(c.a)(Object(c.a)({},r),{},Object(o.a)({},e,Object(c.a)(Object(c.a)({},r[e]),{},Object(o.a)({},t,n))))}))}function M(e,t,n,r){var s=function(e,t){return S[e].find((function(e){return e.field===t}))}(e,t);!n&&s?A((function(n){return Object(c.a)(Object(c.a)({},n),{},Object(o.a)({},e,n[e].filter((function(e){return e.field!==t}))))})):n&&!s&&A((function(n){return Object(c.a)(Object(c.a)({},n),{},Object(o.a)({},e,n[e].concat({field:t,message:r})))}))}Object(r.useEffect)((function(){var e=window&&window.location.search;e&&(e.match("[?&]feature=([^&]+)")&&E(!0),e.match("[?&]default=es")&&i(!0))}),[]),Object(r.useEffect)((function(){T((function(e){var t="az-k8s-".concat((Math.floor(9e5*Math.random())+1e5).toString(36));return Object(c.a)(Object(c.a)({},e),{},{deploy:Object(c.a)(Object(c.a)({},e.deploy),{},{clusterName:t,rg:"".concat(t,"-rg")},{kubernetesVersion:"1.20.9"})})})),fetch("https://api.ipify.org?format=json").then((function(e){return e.json()})).then((function(e){T((function(t){return Object(c.a)(Object(c.a)({},t),{},{deploy:Object(c.a)(Object(c.a)({},t.deploy),{},{apiips:e.ip})})}))})).catch((function(e){return console.error("Problem fetching my IP",e)}))}),[]);var B=D.deploy,W=D.cluster,V=D.net,R=D.addons;function F(e,t,n){return Object(P.jsxs)("span",{children:[S[e].length>0&&Object(P.jsx)(g.a,{iconName:"Warning12",style:{color:"red"}}),n(t)]})}return M("cluster","osDiskType","Ephemeral"===W.osDiskType&&!X.find((function(e){return e.key===W.vmSize})).eph,"The selected VM cache is not large enough to support Ephemeral. Select 'Managed' or a VM with a larger cache"),M("cluster","aad_tenant_id",W.enable_aad&&W.use_alt_aad&&36!==W.aad_tenant_id.length,"Enter Valid Directory ID"),M("addons","registry",(V.vnetprivateend||V.serviceEndpointsEnable)&&"Premium"!==R.registry&&"none"!==R.registry,"Premium tier is required for Service Endpoints & Private Link, either select Premium, or disable Service Endpoints and Private Link"),M("addons","dnsZoneId",R.dns&&!R.dnsZoneId.match("^/subscriptions/[^/ ]+/resourceGroups/[^/ ]+/providers/Microsoft.Network/(dnszones|privateDnsZones)/[^/ ]+$"),"Enter valid Azure Public or Private DNS Zone resourceId"),M("addons","certEmail",R.certMan&&!R.certEmail.match("^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$"),"Enter valid email for certificate generation"),M("addons","kvId","akvExist"===R.csisecret&&!R.kvId.match("^/subscriptions/[^/ ]+/resourceGroups/[^/ ]+/providers/Microsoft.KeyVault/vaults/[^/ ]+$"),"Enter valid Azure KeyVault resourceId"),M("addons","appgw_privateIpAddress","appgw"===R.ingress&&R.appgw_privateIp&&!R.appgw_privateIpAddress.match("^(?:[0-9]{1,3}.){3}[0-9]{1,3}$"),"Enter valid IP address"),M("addons","appgwKVIntegration","appgw"===R.ingress&&R.appgwKVIntegration&&"akvNew"!==R.csisecret,"Keyvault integration requires the 'CSI Secrets' 'Yes, Provision a new KeyVault' option to be selected"),M("net","byoAKSSubnetId","byo"===V.vnet_opt&&!V.byoAKSSubnetId.match("^/subscriptions/[^/ ]+/resourceGroups/[^/ ]+/providers/Microsoft.Network/virtualNetworks/[^/ ]+/subnets/[^/ ]+$"),"Enter a valid Subnet Id where AKS nodes will be installed"),M("net","byoAGWSubnetId","byo"===V.vnet_opt&&"appgw"===R.ingress&&!V.byoAGWSubnetId.match("^/subscriptions/[^/ ]+/resourceGroups/[^/ ]+/providers/Microsoft.Network/virtualNetworks/[^/ ]+/subnets/[^/ ]+$"),"Enter a valid Subnet Id where Application Gateway is installed"),M("net","vnet_opt","default"===V.vnet_opt&&(V.serviceEndpointsEnable||V.afw||V.vnetprivateend),"Cannot use default networking of you select Firewall, Service Endpoints, or Private Link"),M("net","afw",V.afw&&"custom"!==V.vnet_opt,"byo"===V.vnet_opt?"Please de-select, when using Bring your own VNET, configure a firewall as part of your own VNET setup, (in a subnet or peered network)":"Template can only deploy Azure Firewall in single VNET with Custom Networking"),M("deploy","apiips","whitelist"===W.apisecurity&&B.apiips.length<7,"Enter an IP/CIDR, or disable API Security in 'Cluster Details' tab"),M("deploy","clusterName",!B.clusterName||null===B.clusterName.match(/^[a-z0-9][_\-a-z0-9]+[a-z0-9]$/i),"Enter valid cluster name"),Object(P.jsxs)("main",{id:"mainContent",className:"wrapper",children:[Object(P.jsx)(re,{entScale:a,setEntScale:i,featureFlag:z}),Object(P.jsxs)(d.a,{verticalFill:!0,styles:{root:{width:"960px",margin:"0 auto",color:"grey"}},children:[Object(P.jsx)(N,{sections:a?v:k,updateCardValues:function(e,t){for(var n=(a?v:k).find((function(t){return t.key===e})).cards.find((function(e){return e.key===t})).values,r=function(){var r=i[s];console.log("updateCardValues(".concat(e,", ").concat(t,") -> ").concat(r)),T((function(e){return Object(c.a)(Object(c.a)({},e),{},Object(o.a)({},r,Object(c.a)(Object(c.a)({},e[r]),Object.keys(n[r]).reduce((function(t,s){var a=n[r][s],i=Array.isArray(a)&&a.length>0&&"object"===typeof a[0]&&a[0].hasOwnProperty("set")?a.reduce((function(t,n){return void 0===t?n.page&&n.field?e[n.page][n.field]===n.value?n.set:void 0:n.set:t}),void 0):a;return console.log("updateCardValues: setting tab=".concat(r,", field=").concat(s," val=").concat(JSON.stringify(a)," targetVal=").concat(JSON.stringify(i))),Object(c.a)(Object(c.a)({},t),{},Object(o.a)({},s,i))}),{}))))}))},s=0,i=Object.keys(n);s<i.length;s++)r()}}),Object(P.jsxs)(h.a,{styles:{root:{marginTop:"55px !important",marginBottom:"5px"}},children:[Object(P.jsx)("b",{children:"Deploy"})," (optionally use 'Details' tabs for additional configuration)"]}),Object(P.jsxs)(m.a,{selectedKey:b,onLinkClick:function(e){j(e.props.itemKey)},children:[Object(P.jsx)(y.a,{headerText:f.deploy,itemKey:"deploy",onRenderItemLink:function(e,t){return F("deploy",e,t)},children:Object(P.jsx)(te,{defaults:x,tabValues:D,updateFn:function(e,t){return K("deploy",e,t)},invalidArray:S.deploy,invalidTabs:Object.keys(S).filter((function(e){return S[e].length>0})).map((function(e){return"'".concat(f[e],"'")}))})}),Object(P.jsx)(y.a,{headerText:f.cluster,itemKey:"cluster",onRenderItemLink:function(e,t){return F("cluster",e,t)},children:Object(P.jsx)(ee,{tabValues:D,updateFn:function(e,t){return K("cluster",e,t)},invalidArray:S.cluster})}),Object(P.jsx)(y.a,{headerText:f.addons,itemKey:"addons",onRenderItemLink:function(e,t){return F("addons",e,t)},children:Object(P.jsx)($,{tabValues:D,updateFn:function(e,t){return K("addons",e,t)},invalidArray:S.addons})}),Object(P.jsx)(y.a,{headerText:f.net,itemKey:"net",onRenderItemLink:function(e,t){return F("net",e,t)},children:Object(P.jsx)(q,{tabValues:D,featureFlag:z,updateFn:function(e,t){return K("net",e,t)},invalidArray:S.net})})]})]})]})}function ae(){return Object(P.jsx)(le.Consumer,{children:function(e){return Object(P.jsx)(se,{config:e})}})}Object(ne.a)();Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ie=n(178),oe=n(90),ce=new ie.a({config:{instrumentationKey:""}});var le=s.a.createContext();i.a.render(Object(P.jsx)(le.Provider,{value:oe,children:Object(P.jsx)(ae,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},90:function(e){e.exports=JSON.parse('{"tabLabels":{"deploy":"Deploy","cluster":"Cluster Details","addons":"Addon Details","net":"Networking Details"},"defaults":{"deploy":{"kubernetesVersion":"1.20.9","location":"WestEurope","apiips":"","demoapp":false,"disablePreviews":false},"cluster":{"apisecurity":"none","privateDNSZone":"none","autoscale":false,"upgradeChannel":"none","SystemPoolType":"Cost-Optimised","count":2,"maxCount":20,"vmSize":"Standard_DS3_v2","osDiskSizeGB":0,"osDiskType":"Ephemeral","enable_aad":true,"use_alt_aad":false,"aad_tenant_id":"","enableAzureRBAC":true,"adminprincipleid":"","aadgroupids":"","availabilityZones":"no"},"addons":{"networkPolicy":"none","azurepolicy":"none","ingress":"none","ingressEveryNode":false,"appgw_privateIp":false,"appgw_privateIpAddress":"","appGWautoscale":true,"appGWcount":0,"appGWmaxCount":10,"appGWsku":"WAF_v2","appgwKVIntegration":false,"certMan":false,"certEmail":"","dns":false,"dnsZoneId":"","registry":"none","podid":false,"podscale":false,"monitor":"none","retentionInDays":30,"csisecret":"none","kvId":"","gitops":"none"},"net":{"networkPlugin":"azure","afw":false,"vnetprivateend":false,"serviceEndpoints":[],"serviceEndpointsEnable":false,"vnet_opt":"default","byoAKSSubnetId":"","byoAGWSubnetId":"","vnetAddressPrefix":"10.0.0.0/8","vnetAksSubnetAddressPrefix":"10.240.0.0/16","ilbsub":"10.241.0.0/24","vnetFirewallSubnetAddressPrefix":"10.241.130.0/26","ersub":"10.242.0.0/24","vnetAppGatewaySubnetAddressPrefix":"10.2.0.0/16","podCidr":"10.244.0.0/16","serviceCidr":"10.0.0.0/16","dnsServiceIP":"10.0.0.10"}},"defaultOps":[{"key":"ops","sectionTitle":"Operations Principles","cards":[{"key":"none","title":"Simplest bare-bones cluster","description":{"title":"Just kubernetes please, I will make desisions later","bulets":[]},"icon":"Manufacturing","values":{"cluster":{"autoscale":false,"upgradeChannel":"none"},"addons":{"registry":"none","ingress":"none","monitor":"none"}}},{"key":"oss","title":"I prefer control & commuity opensource soltuions","description":{"title":"Use proven, opensource projects for my Kubernetes operational environment, and self-manage my clusters upgrades and scalling","bulets":[{"description":"Manual Upgrades"},{"description":"Manual Scalling"},{"description":"Contour Ingress","linksrc":"https://projectcontour.io/"},{"description":"Promethous/Grahana Monitoring","linksrc":"https://coreos.com/operators/prometheus/docs/latest/user-guides/getting-started.html"},{"description":"Dockerhub container registry"}]},"icon":"DeveloperTools","values":{"cluster":{"autoscale":false,"upgradeChannel":"none"},"addons":{"registry":"none","ingress":"contour","monitor":"oss"}}},{"key":"managed","default":true,"title":"I want a managed environment","description":{"title":"I\'d like my cluster to be auto-managed by Azure for upgrades and scalling, and use Azure provided managed addons to create an full environment with the minimum of operational requirements","bulets":[{"description":"Cluster auto-scaller","linksrc":"https://docs.microsoft.com/en-us/azure/aks/cluster-autoscaler"},{"description":"Cluser auto-upgrades","linksrc":"https://docs.microsoft.com/en-us/azure/aks/upgrade-cluster#set-auto-upgrade-channel"},{"description":"Azure Monitor for Containers","linksrc":"https://docs.microsoft.com/en-us/azure/azure-monitor/insights/container-insights-overview"},{"description":"Azure Container Registry"},{"description":"Azure AppGateway Ingress","linksrc":"https://docs.microsoft.com/en-gb/azure/application-gateway/ingress-controller-overview"}]},"icon":"Touch","values":{"cluster":{"autoscale":true,"upgradeChannel":"stable"},"addons":{"registry":[{"page":"net","field":"vnetprivateend","value":true,"set":"Premium"},{"page":"net","field":"serviceEndpointsEnable","value":true,"set":"Premium"},{"set":"Basic"}],"ingress":"appgw","appgwKVIntegration":[{"page":"addons","field":"csisecret","value":"akvNew","set":true},{"set":false}],"monitor":"aci"}}}]},{"key":"secure","sectionTitle":"Security Principles","cards":[{"key":"low","title":"Simple cluster with no additional access limitations","description":{"title":"Simplest option for experimenting with kubernetes, or clusters with no sensitive data","bulets":[]},"icon":"Unlock","values":{"cluster":{"enable_aad":false,"apisecurity":"none"},"addons":{"networkPolicy":"none","registry":[{"page":"addons","field":"registry","value":"Standard","set":"Basic"},{"page":"addons","field":"registry","value":"Premium","set":"Basic"},{"set":"none"}],"azurepolicy":"none","appgwKVIntegration":false,"csisecret":"none"},"net":{"vnet_opt":"default","serviceEndpointsEnable":false,"vnetprivateend":false,"afw":false}}},{"key":"normal","default":true,"title":"Custer with additional security controls","description":{"title":"Good option for implmenting recommended minimum security controls for regular environments","bulets":[{"description":"AAD Integration","linksrc":"https://docs.microsoft.com/en-gb/azure/aks/managed-aad"},{"description":"AUDIT Pod security baseline standards","linksrc":"https://docs.microsoft.com/en-us/azure/governance/policy/concepts/policy-for-kubernetes"},{"description":"East-West traffic control","linksrc":"https://docs.microsoft.com/en-gb/azure/aks/use-network-policies"},{"description":"Authorized IP address ranges","linksrc":"https://docs.microsoft.com/en-us/azure/aks/api-server-authorized-ip-ranges"},{"description":"Restrict dependencies with Service Endpoints **(ACR preview)","linksrc":"https://docs.microsoft.com/en-us/azure/virtual-network/virtual-network-service-endpoints-overview"}]},"icon":"Lock12","values":{"cluster":{"enable_aad":true,"apisecurity":"whitelist"},"addons":{"networkPolicy":"calico","registry":[{"page":"addons","field":"registry","value":"Basic","set":"Premium"},{"page":"addons","field":"registry","value":"Standard","set":"Premium"},{"page":"addons","field":"registry","value":"Premium","set":"Premium"},{"set":"none"}],"azurepolicy":"audit","appgwKVIntegration":[{"page":"addons","field":"ingress","value":"appgw","set":true},{"set":false}],"csisecret":"akvNew"},"net":{"vnet_opt":"custom","serviceEndpointsEnable":true,"serviceEndpoints":["Microsoft.ContainerRegistry","Microsoft.KeyVault"],"vnetprivateend":false,"afw":false}}},{"key":"private","title":"Private cluster with isolating networking controls","description":{"title":"Best option for high-secure, regulated environments or sensitive data requirements.","titleWarning":{"description":"WARNING: most complex environment option to operate","MessageBarType":5},"bulets":[{"description":"AAD Integration","linksrc":"https://docs.microsoft.com/en-gb/azure/aks/managed-aad"},{"description":"ENFORCE Pod security baseline standards","linksrc":"https://docs.microsoft.com/en-us/azure/governance/policy/concepts/policy-for-kubernetes"},{"description":"East-West traffic control","linksrc":"https://docs.microsoft.com/en-gb/azure/aks/use-network-policies"},{"description":"Private Cluster","linksrc":"https://docs.microsoft.com/en-us/azure/aks/private-clusters"},{"description":"Restrict dependencies with Private Link","linksrc":"https://docs.microsoft.com/en-us/azure/private-link/private-link-overview"},{"description":"Restrict egress with Azure firewall","linksrc":"https://docs.microsoft.com/en-us/azure/aks/limit-egress-traffic#restrict-egress-traffic-using-azure-firewall"},{"description":"Store Kubernetes Secrets in Azure Keyvault,","linksrc":"https://docs.microsoft.com/en-us/azure/aks/csi-secrets-store-driver"}]},"icon":"ProtectionCenterLogo32","values":{"cluster":{"enable_aad":true,"apisecurity":"private"},"addons":{"networkPolicy":"calico","registry":[{"page":"addons","field":"registry","value":"Basic","set":"Premium"},{"page":"addons","field":"registry","value":"Standard","set":"Premium"},{"page":"addons","field":"registry","value":"Premium","set":"Premium"},{"set":"none"}],"appgwKVIntegration":[{"page":"addons","field":"ingress","value":"appgw","set":true},{"set":false}],"azurepolicy":"deny","csisecret":"akvNew"},"net":{"vnet_opt":"custom","serviceEndpointsEnable":false,"vnetprivateend":true,"afw":true}}}]}],"entScaleOps":[{"key":"entscale","sectionTitle":"Enterprise Scale Management Group","sectionWarning":"Before you continue, Ensure you have deployed the Enterprise Scale reference implementation","cards":[{"key":"sandbox","default":true,"title":"Sandbox","description":{"title":"For dev/test applications, and other experimental purposes. Sandbox Subscriptions will not typically be allowed connectivity to Production and Policy will prevent the connectivity to on-premises Resources.","bulets":[{"description":"Cluster auto-scaler (2-4 nodes)","linksrc":"https://docs.microsoft.com/en-us/azure/aks/cluster-autoscaler"},{"description":"Azure Monitor for Containers","linksrc":"https://docs.microsoft.com/en-us/azure/azure-monitor/insights/container-insights-overview"},{"description":"Azure Container Registry (public)"},{"description":"AAD Integration","linksrc":"https://docs.microsoft.com/en-gb/azure/aks/managed-aad"},{"description":"Audit Pod security baseline standards","linksrc":"https://docs.microsoft.com/en-us/azure/governance/policy/concepts/policy-for-kubernetes"}]},"imageSrc":"./Entscale-sandbox.png","author":{"name":"Gordon Byers","initials":"GB","status":"Updated March, 2021"},"values":{"cluster":{"enable_aad":true,"apisecurity":"none","autoscale":true,"count":2,"maxCount":4,"upgradeChannel":"none"},"addons":{"networkPolicy":"none","registry":"Basic","azurepolicy":"audit","ingress":"none","appgwKVIntegration":false,"monitor":"aci","csisecret":"none"},"net":{"serviceEndpointsEnable":false,"vnetprivateend":false,"vnet_opt":"default","afw":false}}},{"key":"corp","default":true,"title":"Corp (Connnected existing Hub)","description":{"title":"For Corp connected applications that require connectivity to on-premises, to other landing zones or to the internet via shared services provided in a network hub","titleWarning":{"description":"Requires existing Subnet, preconfigured with firewall egress","MessageBarType":5},"bulets":[{"description":"Cluster auto-scaler","linksrc":"https://docs.microsoft.com/en-us/azure/aks/cluster-autoscaler"},{"description":"Azure Monitor for Containers","linksrc":"https://docs.microsoft.com/en-us/azure/azure-monitor/insights/container-insights-overview"},{"description":"Azure Container Registry (with Private Link)"},{"description":"Azure AppGateway Ingress","linksrc":"https://docs.microsoft.com/en-gb/azure/application-gateway/ingress-controller-overview"},{"description":"AAD Integration","linksrc":"https://docs.microsoft.com/en-gb/azure/aks/managed-aad"},{"description":"Audit Pod security baseline standards","linksrc":"https://docs.microsoft.com/en-us/azure/governance/policy/concepts/policy-for-kubernetes"},{"description":"East-West traffic control","linksrc":"https://docs.microsoft.com/en-gb/azure/aks/use-network-policies"},{"description":"Private Cluster","linksrc":"https://docs.microsoft.com/en-us/azure/aks/private-clusters"},{"description":"Restrict dependencies with Private Link","linksrc":"https://docs.microsoft.com/en-us/azure/private-link/private-link-overview"},{"description":"Store Kubernetes Secrets in Azure Keyvault,","linksrc":"https://docs.microsoft.com/en-us/azure/aks/csi-secrets-store-driver"}]},"imageSrc":"./Entscale-corp.png","author":{"name":"Gordon Byers","initials":"GB","status":"Updated March, 2021"},"values":{"cluster":{"enable_aad":true,"apisecurity":"private","autoscale":true,"upgradeChannel":"none"},"addons":{"networkPolicy":"calico","registry":"Premium","azurepolicy":"audit","ingress":"appgw","monitor":"aci","csisecret":"akvNew","appgwKVIntegration":true},"net":{"serviceEndpointsEnable":false,"vnetprivateend":true,"vnet_opt":"byo","afw":false}}},{"key":"online","default":true,"title":"Online (Internet facing)","description":{"title":"For Online applications that will be internet-facing, where hybrid connectivity is not required","bulets":[{"description":"Cluster auto-scaler","linksrc":"https://docs.microsoft.com/en-us/azure/aks/cluster-autoscaler"},{"description":"Azure Monitor for Containers","linksrc":"https://docs.microsoft.com/en-us/azure/azure-monitor/insights/container-insights-overview"},{"description":"Azure Container Registry (with Private Link)"},{"description":"Azure AppGateway Ingress","linksrc":"https://docs.microsoft.com/en-gb/azure/application-gateway/ingress-controller-overview"},{"description":"AAD Integration","linksrc":"https://docs.microsoft.com/en-gb/azure/aks/managed-aad"},{"description":"Audit Pod security baseline standards","linksrc":"https://docs.microsoft.com/en-us/azure/governance/policy/concepts/policy-for-kubernetes"},{"description":"East-West traffic control","linksrc":"https://docs.microsoft.com/en-gb/azure/aks/use-network-policies"},{"description":"Private Cluster","linksrc":"https://docs.microsoft.com/en-us/azure/aks/private-clusters"},{"description":"Restrict dependencies with Private Link","linksrc":"https://docs.microsoft.com/en-us/azure/private-link/private-link-overview"},{"description":"Restrict egress with Azure firewall (provisioned & configured seperatly)","linksrc":"https://docs.microsoft.com/en-us/azure/aks/limit-egress-traffic#restrict-egress-traffic-using-azure-firewall"},{"description":"Store Kubernetes Secrets in Azure Keyvault,","linksrc":"https://docs.microsoft.com/en-us/azure/aks/csi-secrets-store-driver"}]},"imageSrc":"./Entscale-online.png","author":{"name":"Gordon Byers","initials":"GB","status":"Updated March, 2021"},"values":{"cluster":{"enable_aad":true,"apisecurity":"private","autoscale":true,"upgradeChannel":"none"},"addons":{"networkPolicy":"calico","registry":"Premium","azurepolicy":"audit","ingress":"appgw","monitor":"aci","csisecret":"akvNew","appgwKVIntegration":true},"net":{"serviceEndpointsEnable":false,"vnetprivateend":true,"vnet_opt":"custom","afw":true}}}]}]}')}},[[112,1,2]]]);
//# sourceMappingURL=main.9171cdc2.chunk.js.map